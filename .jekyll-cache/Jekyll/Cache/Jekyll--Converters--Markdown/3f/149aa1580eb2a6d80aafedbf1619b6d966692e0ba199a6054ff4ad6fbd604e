I"‚o<ul>
  <li>æ¨¡å—åŠ è½½å™¨è®¾è®¡æ€ç»´å¯¼å›¾</li>
  <li>seajsæºç åˆ†æ</li>
</ul>

<h2 id="æ¨¡å—åŠ è½½å™¨è®¾è®¡">æ¨¡å—åŠ è½½å™¨è®¾è®¡</h2>

<p>æ¨¡å—åŠ è½½å™¨æ ¸å¿ƒéƒ¨åˆ†</p>

<ul>
  <li><code class="highlighter-rouge">æ¨¡å—éƒ¨åˆ†</code>ï¼š<code class="highlighter-rouge">æ•°æ®åˆå§‹åŒ–</code>ã€<code class="highlighter-rouge">æ¨¡å—å­˜å‚¨</code>ã€‚æ¯ä¸ªæ¨¡å—åˆ›å»ºéƒ½å…ˆåˆå§‹åŒ–æ•°æ®ï¼Œå­˜å‚¨åœ¨ç¼“å­˜å¯¹è±¡ä¸­</li>
  <li><code class="highlighter-rouge">èµ„æºéƒ¨åˆ†</code>ï¼š<code class="highlighter-rouge">ä¾èµ–ç®¡ç†</code>ã€<code class="highlighter-rouge">èµ„æºå®šä¹‰</code>ã€<code class="highlighter-rouge">åŠ¨æ€åŠ è½½scriptæ–‡ä»¶</code>ã€‚èµ„æºå®šä½ä¾èµ–ç®¡ç†æ˜¯åŠ è½½å™¨è®¾è®¡ä¸¤å¤§æ ¸å¿ƒ</li>
</ul>

<h3 id="1-æ•°æ®åˆå§‹åŒ–">1 æ•°æ®åˆå§‹åŒ–</h3>

<ul>
  <li>åŠ è½½å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªåä¸ºModuleæ„é€ å‡½æ•°ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æ˜¯æ­¤æ„é€ å‡½æ•°å®ä¾‹å¯¹è±¡ã€‚</li>
  <li>æ„é€ å‡½æ•°ä¸­ç»™å®ä¾‹å¯¹è±¡æ‰©å±•äº†ï¼Œ â€˜æœªæ¥â€™æ‰€éœ€è¦çš„ç”¨åˆ°çš„å±æ€§ä»¥åŠæ–¹æ³•ï¼Œ</li>
  <li>urlï¼šå½“å‰æ¨¡å—çš„ç»å¯¹è·¯å¾„åœ°å€</li>
  <li>depsï¼šæ¨¡å—çš„ä¾èµ–åˆ—è¡¨ã€‚</li>
  <li>â€¦</li>
</ul>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="o">(</span><span class="no">function</span><span class="o">(</span><span class="no">global</span><span class="o">){</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">global</span><span class="p">.</span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w">
      </span><span class="no">version</span><span class="p">:</span><span class="w"> </span><span class="k">'</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="k">'</span><span class="w">
    </span><span class="o">}</span><span class="p">;</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{}</span><span class="p">;</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{}</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">ç¼“å­˜å¯¹è±¡ï¼Œæ¨¡å—çš„ä¿¡æ¯</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">anonymousMeta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{}</span><span class="p">;</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w">
      </span><span class="no">FETCHEN</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w">
      </span><span class="no">SAVED</span><span class="p">:</span><span class="mi">2</span><span class="o">,</span><span class="w">
      </span><span class="no">LOADING</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="o">,</span><span class="w">
      </span><span class="no">LOADED</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="o">,</span><span class="w">
      </span><span class="no">EXECUTING</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="o">,</span><span class="w">
      </span><span class="no">EXECUTED</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
    </span><span class="o">}</span><span class="w">
    </span><span class="o">//</span><span class="w"> </span><span class="err">æ„é€ å‡½æ•°</span><span class="w"> </span><span class="err">æ¨¡å—</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">å®ä¾‹åŒ–</span><span class="w">
    </span><span class="no">function</span><span class="w"> </span><span class="k">Module</span><span class="o">(</span><span class="no">uri</span><span class="o">,</span><span class="w"> </span><span class="no">deps</span><span class="o">){</span><span class="w">
      </span><span class="nn">this</span><span class="p">.</span><span class="no">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">uri</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">å½“å‰æ¨¡å—çš„ç»å¯¹è·¯å¾„åœ°å€</span><span class="w">
      </span><span class="nn">this</span><span class="p">.</span><span class="no">deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">deps</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[]</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ¨¡å—çš„ä¾èµ–åˆ—è¡¨</span><span class="w">
      </span><span class="nn">this</span><span class="p">.</span><span class="no">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">null</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">å¯¼å‡ºçš„æ¥å£å¯¹è±¡</span><span class="w">
      </span><span class="nn">this</span><span class="p">.</span><span class="no">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">ç”Ÿå‘½å‘¨æœŸ</span><span class="w"> </span><span class="err">çŠ¶æ€ç </span><span class="w"> </span><span class="mi">1</span><span class="o">(</span><span class="err">åˆå§‹åŒ–</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">6</span><span class="err">ï¼ˆåŠ è½½å®Œæ¯•ï¼‰</span><span class="w"> </span><span class="o">(</span><span class="err">é¿å…é‡å¤åŠ è½½</span><span class="o">)</span><span class="w">
      </span><span class="nn">this</span><span class="p">.</span><span class="no">_waitings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{}</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ£€æµ‹æœºåˆ¶ï¼Œè°ä¼šä¾èµ–äºæˆ‘ï¼Œæˆ‘ä¼šä¾èµ–è°</span><span class="w"> </span><span class="err">ï¼ˆå¾ªç¯ä¾èµ–é—®é¢˜ï¼‰</span><span class="w">
      </span><span class="nn">this</span><span class="p">.</span><span class="no">_remain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">ä¾èµ–æ¨¡å—çš„ä¸ªæ•°</span><span class="w">
    </span><span class="o">}</span><span class="w">
</span><span class="o">})(</span><span class="no">this</span><span class="o">)</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-æ¨¡å—å­˜å‚¨">2 æ¨¡å—å­˜å‚¨</h3>

<p>åŠ è½½å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªåä¸ºcacheç¼“å­˜å¯¹è±¡ï¼Œæ¯ä¸ªæ–‡ä»¶ï¼ˆæ¨¡å—ï¼‰éƒ½ä¼šå­˜å‚¨åœ¨cacheå¯¹è±¡ä¸­
å…·ä½“å­˜å‚¨æ–¹å¼ï¼šï½›â€å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„â€: new Module()ï½
æ³¨æ„ï¼šå½“å‰æ¨¡å—çš„ç»å¯¹è·¯å¾„æ˜¯é€šè¿‡èµ„æºéƒ¨åˆ†ï¼Œèµ„æºå®šä½æ–¹å¼å®ç°çš„</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="o">(</span><span class="no">function</span><span class="o">(</span><span class="no">global</span><span class="o">){</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">global</span><span class="p">.</span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w">
      </span><span class="no">version</span><span class="p">:</span><span class="w"> </span><span class="k">'</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="k">'</span><span class="w">
    </span><span class="o">}</span><span class="p">;</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{}</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">ç¼“å­˜å¯¹è±¡ï¼Œæ¨¡å—çš„ä¿¡æ¯</span><span class="w">

    </span><span class="nn">Module</span><span class="p">.</span><span class="nn">prototype</span><span class="p">.</span><span class="no">save</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(</span><span class="no">uri</span><span class="o">,</span><span class="w"> </span><span class="no">meta</span><span class="o">){</span><span class="w">
      </span><span class="no">var</span><span class="w"> </span><span class="no">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">Module</span><span class="p">.</span><span class="no">get</span><span class="o">(</span><span class="no">uri</span><span class="o">)</span><span class="p">;</span><span class="w">
      </span><span class="nn">mod</span><span class="p">.</span><span class="no">uri</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="no">uri</span><span class="p">;</span><span class="w">
      </span><span class="nn">mod</span><span class="p">.</span><span class="no">deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">meta</span><span class="p">.</span><span class="no">deps</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[]</span><span class="p">;</span><span class="w">
      </span><span class="nn">mod</span><span class="p">.</span><span class="no">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">meta</span><span class="p">.</span><span class="no">factory</span><span class="p">;</span><span class="w">
      </span><span class="nn">mod</span><span class="p">.</span><span class="no">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">status</span><span class="p">.</span><span class="no">SAVED</span><span class="p">;</span><span class="w">
    </span><span class="o">}</span><span class="w">

    </span><span class="nn">Module</span><span class="p">.</span><span class="no">get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(</span><span class="no">uri</span><span class="o">,</span><span class="w"> </span><span class="no">deps</span><span class="o">){</span><span class="w">
      </span><span class="kr">return</span><span class="w"> </span><span class="no">cache</span><span class="o">[</span><span class="no">uri</span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">(</span><span class="no">cache</span><span class="o">[</span><span class="no">uri</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">new</span><span class="w"> </span><span class="k">Module</span><span class="o">(</span><span class="no">uri</span><span class="o">,</span><span class="w"> </span><span class="no">deps</span><span class="o">))</span><span class="p">;</span><span class="w">
    </span><span class="o">}</span><span class="w">
  
</span><span class="o">})(</span><span class="no">this</span><span class="o">)</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-èµ„æºå®šä½">3 èµ„æºå®šä½</h3>
<p>åŠ è½½å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªresolve()çš„æ–¹æ³•æŠŠæ¨¡å—åè§£ææˆç»å¯¹è·¯å¾„æ ¼å¼ï¼›
æ¨¡å—åŒ–åçš„è·å–
seajs.use[â€˜a.jsâ€™, â€˜b.jsâ€™];
seajs.use()åŠ è½½å™¨å¯åŠ¨æ–¹æ³•ï¼Œå¯åŠ¨æ—¶ä¼šè°ƒç”¨ä¼ å…¥æ•°ç»„åˆ—è¡¨ä¸­çš„æ¨¡å—</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="o">(</span><span class="no">function</span><span class="o">(</span><span class="no">global</span><span class="o">){</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">global</span><span class="p">.</span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w">
      </span><span class="no">version</span><span class="p">:</span><span class="w"> </span><span class="k">'</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="k">'</span><span class="w">
    </span><span class="o">}</span><span class="p">;</span><span class="w">
    </span><span class="o">//</span><span class="w"> </span><span class="err">èµ„æºå®šä½</span><span class="w"> </span><span class="no">resolve</span><span class="o">(</span><span class="s2">"a"</span><span class="o">)</span><span class="w"> 
    </span><span class="nn">seajs</span><span class="p">.</span><span class="no">resolve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(</span><span class="no">child</span><span class="o">,</span><span class="w"> </span><span class="no">parent</span><span class="o">){</span><span class="w">
        </span><span class="kr">if</span><span class="o">(!</span><span class="no">child</span><span class="o">)</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">
        </span><span class="o">//</span><span class="w"> </span><span class="no">alias</span><span class="p">:</span><span class="o">{</span><span class="s2">"a"</span><span class="p">:</span><span class="w"> </span><span class="s2">"common/js/a"</span><span class="o">}</span><span class="w"> 
        </span><span class="no">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">parseAlias</span><span class="o">(</span><span class="no">child</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ˜¯å¦æœ‰æ¨¡å—çš„çŸ­åç§°é…ç½®</span><span class="w">
        </span><span class="no">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">parsePaths</span><span class="o">(</span><span class="no">child</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ˜¯å¦æœ‰è·¯å¾„çš„çŸ­åç§°é…ç½®</span><span class="w">
        </span><span class="no">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">normalize</span><span class="o">(</span><span class="no">child</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ˜¯å¦æœ‰åç¼€ï¼Œå¤„ç†åç¼€</span><span class="no">js</span><span class="w">
        </span><span class="kr">return</span><span class="w"> </span><span class="no">addBase</span><span class="o">(</span><span class="no">child</span><span class="o">,</span><span class="w"> </span><span class="no">parent</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">ç”Ÿæˆæœ€ç»ˆçš„è·¯å¾„åœ°å€</span><span class="w">
    </span><span class="o">}</span><span class="w">

    </span><span class="nn">seajs</span><span class="p">.</span><span class="no">use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(</span><span class="no">list</span><span class="o">,</span><span class="w"> </span><span class="no">callback</span><span class="o">){</span><span class="w">
      </span><span class="nn">Module</span><span class="p">.</span><span class="no">preload</span><span class="o">(</span><span class="no">function</span><span class="o">(){</span><span class="w">
        </span><span class="nn">Module</span><span class="p">.</span><span class="no">use</span><span class="o">(</span><span class="no">list</span><span class="o">,</span><span class="w"> </span><span class="no">callback</span><span class="o">,</span><span class="w"> </span><span class="nn">data</span><span class="p">.</span><span class="no">cwd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"_use_"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">cid</span><span class="o">())</span><span class="p">;</span><span class="w">
    </span><span class="o">})</span><span class="p">;</span><span class="w">
  </span><span class="o">}</span><span class="w">
  
</span><span class="o">})(</span><span class="no">this</span><span class="o">)</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-åŠ¨æ€åŠ è½½scriptæ–‡ä»¶">4 åŠ¨æ€åŠ è½½scriptæ–‡ä»¶</h3>

<ul>
  <li>é€šè¿‡åŠ è½½å™¨resolve()æ–¹æ³•ï¼ŒæŠŠæ¨¡å—åè§£ææˆç»å¯¹è·¯å¾„æ ¼å¼</li>
  <li>åŠ¨æ€åˆ›å»ºscript document.create(â€˜scriptâ€™); src æŒ‡å‘å½“å‰æ¨¡å—ç»å¯¹è·¯å¾„åœ°å€</li>
  <li>åŠ è½½æ–‡ä»¶åŒäº‹ï¼Œæ¨¡å—åŠ è½½å™¨è§£æå½“å‰æ¨¡å—æ‰€ä¾èµ–æ¨¡å—ä»¥æ•°ç»„çš„å½¢å¼å­˜å‚¨</li>
</ul>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="o">(</span><span class="no">function</span><span class="o">(</span><span class="no">global</span><span class="o">){</span><span class="w">
    </span><span class="no">var</span><span class="w"> </span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">global</span><span class="p">.</span><span class="no">seajs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w">
      </span><span class="no">version</span><span class="p">:</span><span class="w"> </span><span class="k">'</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="k">'</span><span class="w">
    </span><span class="o">}</span><span class="p">;</span><span class="w">
    </span><span class="o">//</span><span class="w"> </span><span class="err">èµ„æºå®šä½</span><span class="w"> </span><span class="no">resolve</span><span class="o">(</span><span class="s2">"a"</span><span class="o">)</span><span class="w"> 
    </span><span class="nn">seajs</span><span class="p">.</span><span class="no">resolve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(</span><span class="no">child</span><span class="o">,</span><span class="w"> </span><span class="no">parent</span><span class="o">){</span><span class="w">
        </span><span class="kr">if</span><span class="o">(!</span><span class="no">child</span><span class="o">)</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">
        </span><span class="o">//</span><span class="w"> </span><span class="no">alias</span><span class="p">:</span><span class="o">{</span><span class="s2">"a"</span><span class="p">:</span><span class="w"> </span><span class="s2">"common/js/a"</span><span class="o">}</span><span class="w"> 
        </span><span class="no">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">parseAlias</span><span class="o">(</span><span class="no">child</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ˜¯å¦æœ‰æ¨¡å—çš„çŸ­åç§°é…ç½®</span><span class="w">
        </span><span class="no">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">parsePaths</span><span class="o">(</span><span class="no">child</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ˜¯å¦æœ‰è·¯å¾„çš„çŸ­åç§°é…ç½®</span><span class="w">
        </span><span class="no">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">normalize</span><span class="o">(</span><span class="no">child</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">æ˜¯å¦æœ‰åç¼€ï¼Œå¤„ç†åç¼€</span><span class="no">js</span><span class="w">
        </span><span class="kr">return</span><span class="w"> </span><span class="no">addBase</span><span class="o">(</span><span class="no">child</span><span class="o">,</span><span class="w"> </span><span class="no">parent</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">ç”Ÿæˆæœ€ç»ˆçš„è·¯å¾„åœ°å€</span><span class="w">
    </span><span class="o">}</span><span class="w">

    </span><span class="nn">Module</span><span class="p">.</span><span class="no">use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(</span><span class="no">deps</span><span class="o">,</span><span class="w"> </span><span class="no">callback</span><span class="o">,</span><span class="w"> </span><span class="no">uri</span><span class="o">){</span><span class="w">
      </span><span class="no">var</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">Module</span><span class="p">.</span><span class="no">get</span><span class="o">(</span><span class="no">uri</span><span class="o">,</span><span class="w"> </span><span class="no">isArray</span><span class="o">(</span><span class="no">deps</span><span class="o">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="no">deps</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="no">deps</span><span class="o">])</span><span class="p">;</span><span class="w">
      </span><span class="nn">m</span><span class="p">.</span><span class="no">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(){</span><span class="w">
        </span><span class="no">var</span><span class="w"> </span><span class="no">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span><span class="p">;</span><span class="w">
        </span><span class="no">var</span><span class="w"> </span><span class="no">uris</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">m</span><span class="p">.</span><span class="no">resolve</span><span class="o">()</span><span class="p">;</span><span class="w">
        </span><span class="no">for</span><span class="o">(</span><span class="no">var</span><span class="w"> </span><span class="no">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="no">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nn">uris</span><span class="p">.</span><span class="no">length</span><span class="p">;</span><span class="w"> </span><span class="no">i</span><span class="o">++){</span><span class="w">
          </span><span class="no">exports</span><span class="o">[</span><span class="no">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">cache</span><span class="o">[</span><span class="no">uris</span><span class="o">[</span><span class="no">i</span><span class="o">]].</span><span class="no">exec</span><span class="o">()</span><span class="p">;</span><span class="w">
        </span><span class="o">}</span><span class="w">
        </span><span class="kr">if</span><span class="o">(</span><span class="no">callback</span><span class="o">){</span><span class="w">
          </span><span class="nn">callback</span><span class="p">.</span><span class="no">apply</span><span class="o">(</span><span class="no">global</span><span class="o">,</span><span class="w"> </span><span class="no">exports</span><span class="o">)</span><span class="p">;</span><span class="w">
        </span><span class="o">}</span><span class="w">
      </span><span class="o">}</span><span class="w">
      </span><span class="nn">m</span><span class="p">.</span><span class="no">load</span><span class="o">()</span><span class="p">;</span><span class="w">
    </span><span class="o">}</span><span class="w">
    </span><span class="nn">seajs</span><span class="p">.</span><span class="no">use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">function</span><span class="o">(</span><span class="no">list</span><span class="o">,</span><span class="w"> </span><span class="no">callback</span><span class="o">){</span><span class="w">
      </span><span class="nn">Module</span><span class="p">.</span><span class="no">preload</span><span class="o">(</span><span class="no">function</span><span class="o">(){</span><span class="w">
        </span><span class="nn">Module</span><span class="p">.</span><span class="no">use</span><span class="o">(</span><span class="no">list</span><span class="o">,</span><span class="w"> </span><span class="no">callback</span><span class="o">,</span><span class="w"> </span><span class="nn">data</span><span class="p">.</span><span class="no">cwd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"_use_"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">cid</span><span class="o">())</span><span class="p">;</span><span class="w">
    </span><span class="o">})</span><span class="p">;</span><span class="w">
  </span><span class="o">}</span><span class="w">
  
</span><span class="o">})(</span><span class="no">this</span><span class="o">)</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>
:ET